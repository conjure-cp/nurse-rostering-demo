"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[238],{3807:function(e,n,t){t.d(n,{Cb:function(){return S},HU:function(){return N}});var s=t(7437),l=t(9383),i=t(8860),r=t(4407),a=t(9270),o=t(7924),c=t(7303),d=t(883),u=t(9989),h=t(2499),x=t(857),f=t(927),j=t(1727),m=t(2053),p=t(5814),g=t(2840),y=t(3449),b=t(4964),w=t(517),v=t(5810),C=t(2265),k=t(1584);let S=[{label:"Preferred Shift Time",defaultIndex:0,selectedIndex:0,options:["Day","Night"]},{label:"Maximum Working Days in a Row",defaultIndex:3,selectedIndex:3,options:[...Array.from({length:4},(e,n)=>(n+0).toString())]}],N=e=>{let n=[];return n.push((0,s.jsx)("option",{value:e.options[e.selectedIndex],disabled:!0,hidden:!0,children:e.options[e.selectedIndex]},"default")),e.options.forEach((e,t)=>{n.push((0,s.jsx)("option",{value:t,children:e},t))}),n};n.ZP=e=>{let{isModalOpen:n,onModalOpen:t,onModalClose:_}=e,{skillList:I,addStaffMember:E}=(0,k.Z)(),[D,Z]=C.useState(""),[T,O]=C.useState(""),[P,U]=(0,C.useState)(""),[z,M]=(0,C.useState)(["STAFF"]),A=C.useRef(null),F=e=>{"STAFF"!==e&&M(n=>n.includes(e)?n.filter(n=>n!==e):[...n,e])},H=()=>{""!==D.trim()&&(E(D.trim(),z,S),Z(""),O(""),M(["STAFF"]),_())};return(0,s.jsxs)(l.u_,{isOpen:n,onClose:_,children:[(0,s.jsx)(i.Z,{}),(0,s.jsxs)(r.h,{children:[(0,s.jsx)(a.x,{children:"Create staff member"}),(0,s.jsx)(o.o,{}),(0,s.jsx)(c.f,{children:(0,s.jsxs)("form",{className:"flex flex-col gap-4",onKeyPress:e=>{"Enter"===e.key&&H()},children:[(0,s.jsx)(d.I,{onChange:e=>Z(e.target.value),placeholder:"Name",value:D}),(0,s.jsx)(d.I,{onChange:e=>U(e.target.value),onKeyDown:e=>{if("Enter"===e.key&&""!==P.trim()){e.preventDefault();let n=P.trim().toUpperCase();z.includes(n)||M(e=>[...e,n]),U("")}},placeholder:"New Qualification",value:P}),(0,s.jsxs)(u.E,{children:[Object.keys(I).map((e,n)=>(0,s.jsx)(u.U,{children:(0,s.jsx)(h.C,{size:"l",onClick:()=>F(e),colorScheme:z.includes(e)?"purple":"gray",cursor:"pointer",children:e},n)},n)),z.filter(e=>!I.hasOwnProperty(e)).map((e,n)=>(0,s.jsx)(u.U,{children:(0,s.jsx)(h.C,{size:"l",onClick:()=>F(e),colorScheme:z.includes(e)?"purple":"gray",cursor:"pointer",children:e},"new-".concat(n))},n))]}),(0,s.jsx)(x.U,{allowToggle:!0,children:(0,s.jsxs)(f.Q,{children:[(0,s.jsx)("h2",{children:(0,s.jsxs)(j.K,{children:[(0,s.jsx)(m.xu,{flex:"1",textAlign:"left",children:"Constraints"}),(0,s.jsx)(p.X,{})]})}),(0,s.jsx)(g.H,{pb:4,children:S.map((e,n)=>(0,s.jsxs)("div",{className:"flex my-4 gap-4",children:[(0,s.jsx)(y.k,{className:"text-sm basis-[150%] items-center justify-end",children:(0,s.jsx)("label",{className:"align-right text-right",children:e.label})}),(0,s.jsx)(b.P,{className:"my-1",defaultValue:e.defaultIndex,onChange:n=>{e.selectedIndex=parseInt(n.target.value)},children:N(e)},n)]},n))})]})})]})}),(0,s.jsxs)(w.m,{children:[(0,s.jsx)(v.z,{onClick:_,variant:"ghost",children:"Cancel"}),(0,s.jsx)(v.z,{className:"bg-primary text-white hover:shadow-lg hover:bg-opacity-80",mr:3,onClick:H,disabled:""===D.trim(),ref:A,children:"Create"})]})]})]})}},4238:function(e,n,t){t.d(n,{Z:function(){return T}});var s=t(7437),l=t(9383),i=t(8860),r=t(2265),a=t(4407),o=t(9270),c=t(7924),d=t(7303),u=t(883),h=t(9989),x=t(2499),f=t(857),j=t(927),m=t(1727),p=t(2053),g=t(5814),y=t(2840),b=t(3449),w=t(4964),v=t(517),C=t(5810),k=t(3807),S=t(1584),N=e=>{let{onModalClose:n,staffId:t}=e,{staffList:l,skillList:i,updateStaffMember:N}=(0,S.Z)(),_=l.find(e=>e.id===t),[I,E]=(0,r.useState)(_&&_.name),[D,Z]=(0,r.useState)(""),[T,O]=(0,r.useState)(_?_.skills:[]),P=e=>{"STAFF"!==e&&O(n=>n.includes(e)?n.filter(n=>n!==e):[...n,e])},U=()=>{I&&""!==I.trim()&&(N(t,I.trim(),T,k.Cb),n())};return(0,s.jsxs)(a.h,{children:[(0,s.jsx)(o.x,{children:"Edit staff member"}),(0,s.jsx)(c.o,{}),(0,s.jsx)(d.f,{children:(0,s.jsxs)("form",{className:"flex flex-col gap-4",onKeyPress:e=>{"Enter"===e.key&&U()},children:[(0,s.jsx)(u.I,{placeholder:"Name",value:I,onChange:e=>E(e.target.value)}),(0,s.jsx)(u.I,{onChange:e=>Z(e.target.value),onKeyDown:e=>{if("Enter"===e.key&&""!==D.trim()){e.preventDefault();let n=D.trim().toUpperCase();O(e=>[...e,n]),Z("")}},placeholder:"New Qualification",value:D}),(0,s.jsxs)(h.E,{children:[Object.keys(i).map((e,n)=>(0,s.jsx)(h.U,{children:(0,s.jsx)(x.C,{size:"xl",onClick:()=>P(e),colorScheme:T.includes(e)?"purple":"gray",cursor:"pointer",children:e},n)},n)),T.filter(e=>!i.hasOwnProperty(e)).map((e,n)=>(0,s.jsx)(h.U,{children:(0,s.jsx)(x.C,{size:"xl",onClick:()=>P(e),colorScheme:T.includes(e)?"purple":"gray",cursor:"pointer",children:e},"new-".concat(n))},n))]}),(0,s.jsx)(f.U,{allowToggle:!0,children:(0,s.jsxs)(j.Q,{children:[(0,s.jsx)("h2",{children:(0,s.jsxs)(m.K,{children:[(0,s.jsx)(p.xu,{flex:"1",textAlign:"left",children:"Constraints"}),(0,s.jsx)(g.X,{})]})}),(0,s.jsx)(y.H,{pb:4,children:k.Cb.map((e,n)=>(0,s.jsxs)("div",{className:"flex my-4 gap-4",children:[(0,s.jsx)(b.k,{className:"text-sm basis_[150%] items-center justify-end",children:(0,s.jsx)("label",{className:"align-right text-right",children:e.label})}),(0,s.jsx)(w.P,{className:"my-1",defaultValue:e.selectedIndex,onChange:n=>{e.selectedIndex=parseInt(n.target.value)},children:(0,k.HU)(e)},n)]},n))})]})})]})}),(0,s.jsxs)(v.m,{children:[(0,s.jsx)(C.z,{onClick:n,variant:"ghost",children:"Cancel"}),(0,s.jsx)(C.z,{className:"bg-primary text-white hover:shadow-lg hover:bg-opacity-80",mr:3,onClick:U,disabled:!I||""===I.trim(),children:"Save"})]})]})},_=t(2744),I=t(5330),E=()=>{let[e,n]=(0,r.useState)(!1),t=()=>n(!1);return{ModalComponent:()=>(0,s.jsx)(I.h,{children:(0,s.jsxs)(l.u_,{isOpen:e,onClose:t,children:[(0,s.jsx)(i.Z,{}),(0,s.jsxs)(a.h,{children:[(0,s.jsx)(o.x,{children:"Chakra UI Modal"}),(0,s.jsx)(c.o,{}),(0,s.jsx)(d.f,{children:"Here is some content for the modal."}),(0,s.jsx)(v.m,{children:(0,s.jsx)(C.z,{colorScheme:"blue",onClick:t,children:"Close"})})]})]})}),openModal:()=>n(!0),closeModal:t}},D=e=>{let{onModalClose:n,setType:t,staffId:l}=e,{staffList:i,removeStaffMember:r}=(0,S.Z)(),u=i.find(e=>e.id===l),{ModalComponent:b,openModal:w}=E();return(0,s.jsxs)(a.h,{children:[(0,s.jsx)(o.x,{children:u&&u.name}),(0,s.jsx)(c.o,{}),(0,s.jsx)(d.f,{children:(0,s.jsxs)("form",{className:"flex flex-col gap-4",children:[(0,s.jsxs)(p.xu,{className:"flex justify-between gap-4",children:[(0,s.jsx)("strong",{children:"Qualifications:"}),(0,s.jsx)(h.E,{children:u&&u.skills.map((e,n)=>(0,s.jsx)(h.U,{children:(0,s.jsx)(x.C,{size:"lg",children:e})},n))})]}),(0,s.jsx)(f.U,{allowToggle:!0,children:(0,s.jsxs)(j.Q,{children:[(0,s.jsx)("h2",{children:(0,s.jsxs)(m.K,{children:[(0,s.jsx)(p.xu,{flex:"1",textAlign:"left",children:"Constraints"}),(0,s.jsx)(g.X,{})]})}),(0,s.jsx)(y.H,{pb:4,children:u&&u.constraints.map((e,n)=>(0,s.jsxs)("div",{className:"flex my-4 gap-4 justify-between",children:[(0,s.jsx)("label",{className:"align-right w-fit",children:e.label}),(0,s.jsx)("p",{className:"font-bold",children:e.options[e.selectedIndex]})]},n))})]})})]})}),(0,s.jsxs)(v.m,{className:"flex justify-between",children:[(0,s.jsx)(C.z,{variant:"ghost",color:"red",onClick:()=>{n(),r(l)},children:"Delete"}),(0,s.jsx)(C.z,{leftIcon:(0,s.jsx)(_.CLb,{}),variant:"ghost",onClick:()=>{t("timetable")},children:"Timetable"}),(0,s.jsx)(C.z,{variant:"outline",onClick:()=>{t("edit")},children:"Edit"})]}),(0,s.jsx)(b,{})]})},Z=t(92),T=e=>{let{staffId:n,isModalOpen:t,onModalOpen:a,onModalClose:o}=e,[c,d]=(0,r.useState)("display");return(0,r.useEffect)(()=>{d("display")},[t]),(0,s.jsxs)(l.u_,{isOpen:t,onClose:o,children:[(0,s.jsx)(i.Z,{}),"edit"===c?(0,s.jsx)(N,{onModalClose:o,staffId:n}):"timetable"===c?(0,s.jsx)(Z.Z,{staffId:n}):(0,s.jsx)(D,{onModalClose:o,setType:d,staffId:n})]})}},92:function(e,n,t){var s=t(7437),l=t(4407),i=t(9270),r=t(7924),a=t(7303);t(2265);var o=t(1584),c=t(1440);n.Z=e=>{let{staffId:n}=e,{staffList:t}=(0,o.Z)(),d=t.find(e=>e.id===n);return(0,s.jsxs)(l.h,{children:[(0,s.jsxs)(i.x,{children:[d&&d.name," Personal Timetable"]}),(0,s.jsx)(r.o,{}),(0,s.jsx)(a.f,{children:(0,s.jsx)(c.Z,{staffId:n})})]})}},1440:function(e,n,t){var s=t(7437),l=t(1988),i=t(6262);t(2265);var r=t(1584),a=t(2684),o=t(2744);n.Z=e=>{let{staffId:n}=e,{staffList:t}=(0,r.Z)(),{schedule:c}=(0,a.Z)();t.find(e=>e.id===n);let d=c.filter(e=>e.resourceId===n),u=function(e){let n=!(arguments.length>1)||void 0===arguments[1]||arguments[1],t=new Date(e),s={month:"long",day:"numeric"};return n&&(s.weekday="long"),t.toLocaleString("en-US",s)},h=e=>e.getHours()>=19?(0,s.jsxs)("div",{className:"flex gap-2 leading-none",children:[(0,s.jsx)(o.v70,{}),(0,s.jsx)(l.x,{children:"Night Shift"})]}):(0,s.jsxs)("div",{className:"flex gap-2 leading-none",children:[(0,s.jsx)(o.Wn6,{}),(0,s.jsx)(l.x,{children:"Day Shift"})]}),x=(e=>{let n=e.sort((e,n)=>new Date(e.start).getTime()-new Date(n.start).getTime()),t={};return n.forEach(e=>{let n=new Date(e.start);n.setDate(n.getDate()-(n.getDay()+6)%7);let s=n.toISOString().slice(0,10);t[s]||(t[s]=[]),t[s].push(e)}),t})(d);return(0,s.jsx)("div",{children:Object.entries(x).map(e=>{let[n,t]=e;return(0,s.jsxs)(i.g,{spacing:1,align:"start",className:"my-4",children:[(0,s.jsxs)(l.x,{fontWeight:"bold",children:["Week of ",u(n,!1)]}),t.map(e=>(0,s.jsxs)("div",{className:"w-full flex justify-between",children:[(0,s.jsx)(l.x,{children:u(e.start)}),h(new Date(e.start))]},e.id))]},n)})})}},2684:function(e,n,t){t.d(n,{Z:function(){return u}});var s=t(2948),l=t(1096),i=t.n(l),r=t(397),a=t.n(r),o=t(7292),c=t.n(o),d=t(2265);function u(){let e=(0,d.useRef)(-1),[n,t]=(0,s.Z)("schedule",{defaultValue:[]}),[l,r]=(0,d.useState)("");async function a(){let e=await fetch("./static/models/model.essence");r(await e.text())}(0,d.useEffect)(()=>{a()},[]);let o=async e=>await fetch("https://conjure-aas.cs.st-andrews.ac.uk/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobid:e,appName:"nurse-rostering"})}).then(e=>e.json()).then(e=>e||null).catch(e=>(console.error(e),null)),c=async e=>(await a(),await fetch("https://conjure-aas.cs.st-andrews.ac.uk/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appName:"nurse-rostering",solver:"kissat",model:l,data:e,conjure_options:["--savilerow-options","-sat-sum-mdd","--channelling=no","-aai","--responses=2"]})}).then(e=>e.json()).then(e=>e&&e.jobid?e.jobid:null).catch(e=>(console.error(e),null))),u=e=>new Promise(n=>setTimeout(n,e)),h=async n=>{e.current=n.jobid;let s=await o(n.jobid);if(!s)return null;let l=Date.now();for(;"wait"===s.status&&e.current==n.jobid;){if(Date.now()-l>=1e4)return["timeout",[]];await u(1e3),s=await o(n.jobid)}if(!s.solution)return["cancelled",[]];if(s.solution.length>0){let e=function(e,n){let t=i()(),s=1===t.weekday()&&t.isToday()?t:t.weekday(1),l=[7,0],r=[19,0];return["ok",e.map(e=>{let t=e[0][0],i=e[0][1],a=e[1],o=s.add(i-1,"day"),c=1===a?l:r,d=o.hour(c[0]).minute(c[1]).second(0),u=d.clone().add(432e5,"millisecond");return{id:"".concat(t,"-").concat(i,"-").concat(a),resourceId:"".concat(function(e){let n={};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[e[t]]=t);return n}(n.staffEncoding)[t]),start:d.format(),end:u.format()}})]}(s.solution[0].assignment,n);return t(e[1]),e}return["no-solution",[]]};return{schedule:n,setSchedule:t,getSchedule:function(){return n},postSchedule:async(e,n)=>{let t=new Set;e.forEach(e=>{e.skills.forEach(e=>{t.add(e)})});let s={};e.forEach((e,n)=>{s[e.id]=n+1});let l={};Array.from(t).forEach((e,n)=>{l[e]=n+1});let i={nb_nurses:e.length,nb_weeks:4,nb_skills:t.size,preferred_shift_type:{},maximum_working_days_in_a_row:{},nurse_skills:{},skills_lower_bound:{},disallowed:[]};return e.forEach(e=>{let n=e.constraints.find(e=>"Preferred Shift Time"===e.label),t=(null==n?void 0:n.options[(null==n?void 0:n.selectedIndex)||0])||"Day";i.preferred_shift_type[s[e.id]]="Day"===t?1:2;let r=e.constraints.find(e=>"Maximum Working Days in a Row"===e.label);i.maximum_working_days_in_a_row[s[e.id]]=parseInt((null==r?void 0:r.options[(null==r?void 0:r.selectedIndex)||0])||"0",10),i.nurse_skills[s[e.id]]=e.skills.map(e=>l[e])}),Object.entries(n).forEach(e=>{i.skills_lower_bound[l[e[0]]]=e[1].minCount}),{jobid:await c(JSON.stringify(i)),staffEncoding:s,skillEncoding:l}},fetchSchedule:h}}i().extend(a()),i().extend(c())},1584:function(e,n,t){t.d(n,{Z:function(){return i}});var s=t(2948),l=t(9360);function i(){let[e,n]=(0,s.Z)("staffList",{defaultValue:[]}),[t,i]=(0,s.Z)("skillList",{defaultValue:{}}),r=(n,s)=>(s.filter(e=>!t.hasOwnProperty(e)).forEach(e=>{t[e]={count:0,minCount:0}}),Object.entries(t).reduce((t,l)=>{var i,r;let[a,o]=l,c=null!==(r=null===(i=e.find(e=>e.id===n))||void 0===i?void 0:i.skills.filter(e=>e===a).length)&&void 0!==r?r:0,d=o.count-c,u=s.filter(e=>e===a).length;return{...t,...d+u>0?{[a]:{count:d+u,minCount:0}}:{}}},{}));return{staffList:e,skillList:t,addStaffMember:(s,r,a)=>{r=r.map(e=>e.toUpperCase()),n([...e,{id:(0,l.Z)(),name:s,skills:r,constraints:a}]),i({...t,...r.reduce((e,n)=>{var s;return{...e,[n]:{count:((null===(s=t[n])||void 0===s?void 0:s.count)||0)+1,minCount:0}}},{})})},removeStaffMember:t=>{n(e.filter(e=>e.id!==t)),i(r(t,[]))},updateStaffMember:(t,s,l,a)=>{n(e.map(e=>e.id===t?{id:t,name:s,skills:l,constraints:a}:e)),i(r(t,l))},countStaffMembers:()=>e.length,setSkillMinCount:(e,n)=>{t[e]?i({...t,[e]:{...t[e],minCount:n}}):console.warn('Skill "'.concat(e,'" not found in skillList.'))}}}}}]);