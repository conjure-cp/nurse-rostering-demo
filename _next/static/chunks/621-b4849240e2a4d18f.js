"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[621],{387:(e,s,t)=>{t.d(s,{A:()=>d});var n=t(5155),l=t(3092),i=t(6562),r=t(8815),a=t(2755);t(2115);var o=t(2734),c=t(2216);let d=e=>{let{staffId:s}=e,{staffList:t}=(0,o.A)(),d=t.find(e=>e.id===s);return(0,n.jsxs)(l.$,{children:[(0,n.jsxs)(i.r,{children:[d&&d.name," Personal Timetable"]}),(0,n.jsx)(r.s,{}),(0,n.jsx)(a.c,{children:(0,n.jsx)(c.A,{staffId:s})})]})}},1621:(e,s,t)=>{t.d(s,{A:()=>D});var n=t(5155),l=t(6391),i=t(5508),r=t(2115),a=t(3092),o=t(6562),c=t(8815),d=t(2755),h=t(7766),u=t(4535),x=t(5551),f=t(520),j=t(7085),m=t(122),p=t(4541),g=t(7891),y=t(5796),b=t(4101),w=t(5091),v=t(5417),k=t(981),C=t(3344),S=t(2734);let N=e=>{let{onModalClose:s,staffId:t}=e,{staffList:l,skillList:i,updateStaffMember:N}=(0,S.A)(),E=l.find(e=>e.id===t),[A,_]=(0,r.useState)(E&&E.name),[I,D]=(0,r.useState)(""),[T,O]=(0,r.useState)(E?E.skills:[]),P=e=>{"STAFF"!==e&&O(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},$=()=>{A&&""!==A.trim()&&(N(t,A.trim(),T,C.Pu),s())};return(0,n.jsxs)(a.$,{children:[(0,n.jsx)(o.r,{children:"Edit staff member"}),(0,n.jsx)(c.s,{}),(0,n.jsx)(d.c,{children:(0,n.jsxs)("form",{className:"flex flex-col gap-4",onKeyPress:e=>{"Enter"===e.key&&$()},children:[(0,n.jsx)(h.p,{placeholder:"Name",value:A,onChange:e=>_(e.target.value)}),(0,n.jsx)(h.p,{onChange:e=>D(e.target.value),onKeyDown:e=>{if("Enter"===e.key&&""!==I.trim()){e.preventDefault();let s=I.trim().toUpperCase();O(e=>[...e,s]),D("")}},placeholder:"New Qualification",value:I}),(0,n.jsxs)(u.B,{children:[Object.keys(i).map((e,s)=>(0,n.jsx)(u.Q,{children:(0,n.jsx)(x.E,{size:"xl",onClick:()=>P(e),colorScheme:T.includes(e)?"purple":"gray",cursor:"pointer",children:e},s)},s)),T.filter(e=>!i.hasOwnProperty(e)).map((e,s)=>(0,n.jsx)(u.Q,{children:(0,n.jsx)(x.E,{size:"xl",onClick:()=>P(e),colorScheme:T.includes(e)?"purple":"gray",cursor:"pointer",children:e},"new-".concat(s))},s))]}),(0,n.jsx)(f.n,{allowToggle:!0,children:(0,n.jsxs)(j.A,{children:[(0,n.jsx)("h2",{children:(0,n.jsxs)(m.J,{children:[(0,n.jsx)(p.az,{flex:"1",textAlign:"left",children:"Constraints"}),(0,n.jsx)(g.Q,{})]})}),(0,n.jsx)(y.v,{pb:4,children:C.Pu.map((e,s)=>(0,n.jsxs)("div",{className:"flex my-4 gap-4",children:[(0,n.jsx)(b.s,{className:"text-sm basis_[150%] items-center justify-end",children:(0,n.jsx)("label",{className:"align-right text-right",children:e.label})}),(0,n.jsx)(w.l,{className:"my-1",defaultValue:e.selectedIndex,onChange:s=>{e.selectedIndex=parseInt(s.target.value)},children:(0,C.ZH)(e)},s)]},s))})]})})]})}),(0,n.jsxs)(v.j,{children:[(0,n.jsx)(k.$,{onClick:s,variant:"ghost",children:"Cancel"}),(0,n.jsx)(k.$,{className:"bg-primary text-white hover:shadow-lg hover:bg-opacity-80",mr:3,onClick:$,disabled:!A||""===A.trim(),children:"Save"})]})]})};var E=t(2515),A=t(6988);let _=e=>{let{onModalClose:s,setType:t,staffId:h}=e,{staffList:b,removeStaffMember:w}=(0,S.A)(),C=b.find(e=>e.id===h),{ModalComponent:N,openModal:_}=(()=>{let[e,s]=(0,r.useState)(!1),t=()=>s(!1);return{ModalComponent:()=>(0,n.jsx)(A.Z,{children:(0,n.jsxs)(l.aF,{isOpen:e,onClose:t,children:[(0,n.jsx)(i.m,{}),(0,n.jsxs)(a.$,{children:[(0,n.jsx)(o.r,{children:"Chakra UI Modal"}),(0,n.jsx)(c.s,{}),(0,n.jsx)(d.c,{children:"Here is some content for the modal."}),(0,n.jsx)(v.j,{children:(0,n.jsx)(k.$,{colorScheme:"blue",onClick:t,children:"Close"})})]})]})}),openModal:()=>s(!0),closeModal:t}})();return(0,n.jsxs)(a.$,{children:[(0,n.jsx)(o.r,{children:C&&C.name}),(0,n.jsx)(c.s,{}),(0,n.jsx)(d.c,{children:(0,n.jsxs)("form",{className:"flex flex-col gap-4",children:[(0,n.jsxs)(p.az,{className:"flex justify-between gap-4",children:[(0,n.jsx)("strong",{children:"Qualifications:"}),(0,n.jsx)(u.B,{children:C&&C.skills.map((e,s)=>(0,n.jsx)(u.Q,{children:(0,n.jsx)(x.E,{size:"lg",children:e})},s))})]}),(0,n.jsx)(f.n,{allowToggle:!0,children:(0,n.jsxs)(j.A,{children:[(0,n.jsx)("h2",{children:(0,n.jsxs)(m.J,{children:[(0,n.jsx)(p.az,{flex:"1",textAlign:"left",children:"Constraints"}),(0,n.jsx)(g.Q,{})]})}),(0,n.jsx)(y.v,{pb:4,children:C&&C.constraints.map((e,s)=>(0,n.jsxs)("div",{className:"flex my-4 gap-4 justify-between",children:[(0,n.jsx)("label",{className:"align-right w-fit",children:e.label}),(0,n.jsx)("p",{className:"font-bold",children:e.options[e.selectedIndex]})]},s))})]})})]})}),(0,n.jsxs)(v.j,{className:"flex justify-between",children:[(0,n.jsx)(k.$,{variant:"ghost",color:"red",onClick:()=>{s(),w(h)},children:"Delete"}),(0,n.jsx)(k.$,{leftIcon:(0,n.jsx)(E.ISr,{}),variant:"ghost",onClick:()=>{t("timetable")},children:"Timetable"}),(0,n.jsx)(k.$,{variant:"outline",onClick:()=>{t("edit")},children:"Edit"})]}),(0,n.jsx)(N,{})]})};var I=t(387);let D=e=>{let{staffId:s,isModalOpen:t,onModalOpen:a,onModalClose:o}=e,[c,d]=(0,r.useState)("display");return(0,r.useEffect)(()=>{d("display")},[t]),(0,n.jsxs)(l.aF,{isOpen:t,onClose:o,children:[(0,n.jsx)(i.m,{}),"edit"===c?(0,n.jsx)(N,{onModalClose:o,staffId:s}):"timetable"===c?(0,n.jsx)(I.A,{staffId:s}):(0,n.jsx)(_,{onModalClose:o,setType:d,staffId:s})]})}},2216:(e,s,t)=>{t.d(s,{A:()=>c});var n=t(5155),l=t(9168),i=t(7641);t(2115);var r=t(2734),a=t(5543),o=t(2515);let c=e=>{let{staffId:s}=e,{staffList:t}=(0,r.A)(),{schedule:c}=(0,a.A)();t.find(e=>e.id===s);let d=c.filter(e=>e.resourceId===s),h=function(e){let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1],t=new Date(e),n={month:"long",day:"numeric"};return s&&(n.weekday="long"),t.toLocaleString("en-US",n)},u=(e=>{let s=e.sort((e,s)=>new Date(e.start).getTime()-new Date(s.start).getTime()),t={};return s.forEach(e=>{let s=new Date(e.start);s.setDate(s.getDate()-(s.getDay()+6)%7);let n=s.toISOString().slice(0,10);t[n]||(t[n]=[]),t[n].push(e)}),t})(d);return(0,n.jsx)("div",{children:Object.entries(u).map(e=>{let[s,t]=e;return(0,n.jsxs)(i.T,{spacing:1,align:"start",className:"my-4",children:[(0,n.jsxs)(l.E,{fontWeight:"bold",children:["Week of ",h(s,!1)]}),t.map(e=>(0,n.jsxs)("div",{className:"w-full flex justify-between",children:[(0,n.jsx)(l.E,{children:h(e.start)}),new Date(e.start).getHours()>=19?(0,n.jsxs)("div",{className:"flex gap-2 leading-none",children:[(0,n.jsx)(o.ILJ,{}),(0,n.jsx)(l.E,{children:"Night Shift"})]}):(0,n.jsxs)("div",{className:"flex gap-2 leading-none",children:[(0,n.jsx)(o.pvz,{}),(0,n.jsx)(l.E,{children:"Day Shift"})]})]},e.id))]},s)})})}},2734:(e,s,t)=>{t.d(s,{A:()=>i});var n=t(9208),l=t(9737);function i(){let[e,s]=(0,n.A)("staffList",{defaultValue:[]}),[t,i]=(0,n.A)("skillList",{defaultValue:{}}),r=(s,n)=>(n.filter(e=>!t.hasOwnProperty(e)).forEach(e=>{t[e]={count:0,minCount:0}}),Object.entries(t).reduce((t,l)=>{var i,r;let[a,o]=l,c=null!=(r=null==(i=e.find(e=>e.id===s))?void 0:i.skills.filter(e=>e===a).length)?r:0,d=o.count-c,h=n.filter(e=>e===a).length;return{...t,...d+h>0?{[a]:{count:d+h,minCount:0}}:{}}},{}));return{staffList:e,skillList:t,addStaffMember:(n,r,a)=>{r=r.map(e=>e.toUpperCase()),s([...e,{id:(0,l.A)(),name:n,skills:r,constraints:a}]),i({...t,...r.reduce((e,s)=>{var n;return{...e,[s]:{count:((null==(n=t[s])?void 0:n.count)||0)+1,minCount:0}}},{})})},removeStaffMember:t=>{s(e.filter(e=>e.id!==t)),i(r(t,[]))},updateStaffMember:(t,n,l,a)=>{s(e.map(e=>e.id===t?{id:t,name:n,skills:l,constraints:a}:e)),i(r(t,l))},countStaffMembers:()=>e.length,setSkillMinCount:(e,s)=>{t[e]?i({...t,[e]:{...t[e],minCount:s}}):console.warn('Skill "'.concat(e,'" not found in skillList.'))}}}},3344:(e,s,t)=>{t.d(s,{Ay:()=>E,Pu:()=>S,ZH:()=>N});var n=t(5155),l=t(6391),i=t(5508),r=t(3092),a=t(6562),o=t(8815),c=t(2755),d=t(7766),h=t(4535),u=t(5551),x=t(520),f=t(7085),j=t(122),m=t(4541),p=t(7891),g=t(5796),y=t(4101),b=t(5091),w=t(5417),v=t(981),k=t(2115),C=t(2734);let S=[{label:"Preferred Shift Time",defaultIndex:0,selectedIndex:0,options:["Day","Night"]},{label:"Maximum Working Days in a Row",defaultIndex:3,selectedIndex:3,options:[...((e,s)=>Array.from({length:s+1-e},(s,t)=>(t+e).toString()))(0,3)]}],N=e=>{let s=[];return s.push((0,n.jsx)("option",{value:e.options[e.selectedIndex],disabled:!0,hidden:!0,children:e.options[e.selectedIndex]},"default")),e.options.forEach((e,t)=>{s.push((0,n.jsx)("option",{value:t,children:e},t))}),s},E=e=>{let{isModalOpen:s,onModalOpen:t,onModalClose:E}=e,{skillList:A,addStaffMember:_}=(0,C.A)(),[I,D]=k.useState(""),[T,O]=k.useState(""),[P,$]=(0,k.useState)(""),[M,z]=(0,k.useState)(["STAFF"]),F=k.useRef(null),Q=e=>{"STAFF"!==e&&z(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},J=()=>{""!==I.trim()&&(_(I.trim(),M,S),D(""),O(""),z(["STAFF"]),E())};return(0,n.jsxs)(l.aF,{isOpen:s,onClose:E,children:[(0,n.jsx)(i.m,{}),(0,n.jsxs)(r.$,{children:[(0,n.jsx)(a.r,{children:"Create staff member"}),(0,n.jsx)(o.s,{}),(0,n.jsx)(c.c,{children:(0,n.jsxs)("form",{className:"flex flex-col gap-4",onKeyPress:e=>{"Enter"===e.key&&J()},children:[(0,n.jsx)(d.p,{onChange:e=>D(e.target.value),placeholder:"Name",value:I}),(0,n.jsx)(d.p,{onChange:e=>$(e.target.value),onKeyDown:e=>{if("Enter"===e.key&&""!==P.trim()){e.preventDefault();let s=P.trim().toUpperCase();M.includes(s)||z(e=>[...e,s]),$("")}},placeholder:"New Qualification",value:P}),(0,n.jsxs)(h.B,{children:[Object.keys(A).map((e,s)=>(0,n.jsx)(h.Q,{children:(0,n.jsx)(u.E,{size:"l",onClick:()=>Q(e),colorScheme:M.includes(e)?"purple":"gray",cursor:"pointer",children:e},s)},s)),M.filter(e=>!A.hasOwnProperty(e)).map((e,s)=>(0,n.jsx)(h.Q,{children:(0,n.jsx)(u.E,{size:"l",onClick:()=>Q(e),colorScheme:M.includes(e)?"purple":"gray",cursor:"pointer",children:e},"new-".concat(s))},s))]}),(0,n.jsx)(x.n,{allowToggle:!0,children:(0,n.jsxs)(f.A,{children:[(0,n.jsx)("h2",{children:(0,n.jsxs)(j.J,{children:[(0,n.jsx)(m.az,{flex:"1",textAlign:"left",children:"Constraints"}),(0,n.jsx)(p.Q,{})]})}),(0,n.jsx)(g.v,{pb:4,children:S.map((e,s)=>(0,n.jsxs)("div",{className:"flex my-4 gap-4",children:[(0,n.jsx)(y.s,{className:"text-sm basis-[150%] items-center justify-end",children:(0,n.jsx)("label",{className:"align-right text-right",children:e.label})}),(0,n.jsx)(b.l,{className:"my-1",defaultValue:e.defaultIndex,onChange:s=>{e.selectedIndex=parseInt(s.target.value)},children:N(e)},s)]},s))})]})})]})}),(0,n.jsxs)(w.j,{children:[(0,n.jsx)(v.$,{onClick:E,variant:"ghost",children:"Cancel"}),(0,n.jsx)(v.$,{className:"bg-primary text-white hover:shadow-lg hover:bg-opacity-80",mr:3,onClick:J,disabled:""===I.trim(),ref:F,children:"Create"})]})]})]})}},5543:(e,s,t)=>{t.d(s,{A:()=>h});var n=t(9208),l=t(832),i=t.n(l),r=t(6004),a=t.n(r),o=t(9643),c=t.n(o),d=t(2115);function h(){let e=(0,d.useRef)(-1),[s,t]=(0,n.A)("schedule",{defaultValue:[]}),[l,r]=(0,d.useState)("");async function a(){let e=await fetch("./static/models/model.essence");r(await e.text())}(0,d.useEffect)(()=>{a()},[]);let o=async e=>await fetch("https://conjure-aas.cs.st-andrews.ac.uk/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobid:e,appName:"nurse-rostering"})}).then(e=>e.json()).then(e=>e||null).catch(e=>(console.error(e),null)),c=async e=>(await a(),await fetch("https://conjure-aas.cs.st-andrews.ac.uk/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appName:"nurse-rostering",solver:"kissat",model:l,data:e,conjure_options:["--savilerow-options","-sat-sum-mdd","--channelling=no","-aai","--responses=2"]})}).then(e=>e.json()).then(e=>e&&e.jobid?e.jobid:null).catch(e=>(console.error(e),null))),h=e=>new Promise(s=>setTimeout(s,e)),u=async s=>{e.current=s.jobid;let n=await o(s.jobid);if(!n)return null;let l=Date.now();for(;"wait"===n.status&&e.current==s.jobid;){if(Date.now()-l>=1e4)return["timeout",[]];await h(1e3),n=await o(s.jobid)}if(!n.solution)return["cancelled",[]];if(n.solution.length>0){let e=function(e,s){let t=i()(),n=1===t.weekday()&&t.isToday()?t:t.weekday(1),l=[7,0],r=[19,0];return["ok",e.map(e=>{let t=e[0][0],i=e[0][1],a=e[1],o=n.add(i-1,"day"),c=1===a?l:r,d=o.hour(c[0]).minute(c[1]).second(0),h=d.clone().add(432e5,"millisecond");return{id:"".concat(t,"-").concat(i,"-").concat(a),resourceId:"".concat(function(e){let s={};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[e[t]]=t);return s}(s.staffEncoding)[t]),start:d.format(),end:h.format()}})]}(n.solution[0].assignment,s);return t(e[1]),e}return["no-solution",[]]};return{schedule:s,setSchedule:t,getSchedule:function(){return s},postSchedule:async(e,s)=>{let t=new Set;e.forEach(e=>{e.skills.forEach(e=>{t.add(e)})});let n={};e.forEach((e,s)=>{n[e.id]=s+1});let l={};Array.from(t).forEach((e,s)=>{l[e]=s+1});let i={nb_nurses:e.length,nb_weeks:4,nb_skills:t.size,preferred_shift_type:{},maximum_working_days_in_a_row:{},nurse_skills:{},skills_lower_bound:{},disallowed:[]};return e.forEach(e=>{let s=e.constraints.find(e=>"Preferred Shift Time"===e.label),t=(null==s?void 0:s.options[(null==s?void 0:s.selectedIndex)||0])||"Day";i.preferred_shift_type[n[e.id]]="Day"===t?1:2;let r=e.constraints.find(e=>"Maximum Working Days in a Row"===e.label);i.maximum_working_days_in_a_row[n[e.id]]=parseInt((null==r?void 0:r.options[(null==r?void 0:r.selectedIndex)||0])||"0",10),i.nurse_skills[n[e.id]]=e.skills.map(e=>l[e])}),Object.entries(s).forEach(e=>{i.skills_lower_bound[l[e[0]]]=e[1].minCount}),{jobid:await c(JSON.stringify(i)),staffEncoding:n,skillEncoding:l}},fetchSchedule:u}}i().extend(a()),i().extend(c())}}]);