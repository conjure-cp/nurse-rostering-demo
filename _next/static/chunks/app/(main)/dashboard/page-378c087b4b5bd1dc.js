(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[248],{5458:function(e,t,n){Promise.resolve().then(n.bind(n,7411))},7411:function(e,t,n){"use strict";n.r(t);var r=n(7437),l=n(7131),s=n(2641),a=n(2212),i=n(4777),o=n(1215),u=n(8683),c=n(4548),d=n.n(c),f=n(5255),m=n.n(f),h=n(2265);t.default=()=>{let{staffList:e,countStaffMembers:t}=(0,o.Z)(),{schedule:n}=(0,u.Z)(),[c,f]=(0,h.useState)(""),[p,x]=(0,h.useState)(""),[w,j]=(0,h.useState)([]),y=(0,h.useMemo)(()=>{let t={};return e.forEach(e=>{t[e.id]=e.name}),t},[e]),g=(0,h.useMemo)(()=>{let e=d()();return n.filter(t=>{let n=d()(t.start),r=d()(t.end);return(e.isAfter(n)||e.isSame(n))&&(e.isBefore(r)||e.isSame(r))})},[n]),b=(0,h.useMemo)(()=>{let e=d()(),t=n.filter(t=>d()(t.start).isAfter(e)).map(e=>d()(e.start));if(0===t.length)return null;let r=t[0];for(let e=1;e<t.length;e++)t[e].isBefore(r)&&(r=t[e]);return r},[n]),k=(0,h.useMemo)(()=>{if(!b)return null;let e=b.add(12,"hour"),t=n.filter(t=>d()(t.start).isSame(b)&&d()(t.end).isSame(e)).map(e=>y[e.resourceId]);return{start:b,staff:t}},[b,n,y]);function _(e){let t=e/1e3;return"".concat(Math.floor(t/3600),"h ").concat(Math.floor(t%3600/60),"m ").concat(Math.floor(t%60),"s")}return d().extend(m()),(0,h.useEffect)(()=>{let e=()=>{x(_(function(){let e=d()(),t=e.hour();return(t<7?e.clone().hour(7).minute(0).second(0):t<19?e.clone().hour(19).minute(0).second(0):e.clone().add(1,"day").hour(7).minute(0).second(0)).diff(e)}()))};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[]),(0,h.useEffect)(()=>{if(b){let e=()=>{f(_(b.diff(d()()))),k?j(k.staff):j([])};e();let t=setInterval(e,1e3);return()=>clearInterval(t)}},[b,k]),(0,r.jsx)("main",{className:"flex items-center justify-center h-full",children:(0,r.jsx)("div",{className:"flex ml-1 flex-wrap md:flex-nowrap items-center justify-around h-full w-full gap-4 md:ml-5",children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between w-full h-full gap-4",children:[(0,r.jsx)(l.p,{className:"hover-shadow flex bg-primaryContainer rounded-xl w-full flex-grow",children:(0,r.jsxs)(s.k,{className:"mx-8 p-4",children:[(0,r.jsx)(a.d,{children:"Staff"}),(0,r.jsx)(i.J,{className:"text-primaryText",children:t()})]})}),(0,r.jsx)(l.p,{className:"hover-shadow flex bg-primaryContainer rounded-xl w-full flex-grow",children:(0,r.jsxs)(s.k,{className:"mx-8 p-4",children:[(0,r.jsx)(a.d,{children:"Who's on now?"}),(0,r.jsx)(i.J,{className:"text-primaryText",children:g&&g.length>0?g.map(e=>y[e.resourceId]).join(", "):"No one is on shift"})]})}),(0,r.jsx)(l.p,{className:"hover-shadow flex bg-primaryContainer rounded-xl w-full flex-grow",children:(0,r.jsxs)(s.k,{className:"mx-8 p-4",children:[(0,r.jsx)(a.d,{children:"Next staffed shift starts in"}),(0,r.jsx)(i.J,{className:"text-primaryText",children:b?"".concat(c," - ").concat(w.join(", ")):"No upcoming staffed shifts"})]})}),(0,r.jsx)(l.p,{className:"hover-shadow flex bg-primaryContainer rounded-xl w-full flex-grow",children:(0,r.jsxs)(s.k,{className:"mx-8 p-4",children:[(0,r.jsx)(a.d,{children:"Next shift starts in"}),(0,r.jsx)(i.J,{className:"text-primaryText",children:b?p:"No upcoming shifts"})]})})]})})})}},8683:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(9797),l=n(4548),s=n.n(l),a=n(8355),i=n.n(a),o=n(4487),u=n.n(o),c=n(2265);function d(){let e=(0,c.useRef)(-1),[t,n]=(0,r.Z)("schedule",{defaultValue:[]}),[l,a]=(0,c.useState)("");async function i(){let e=await fetch("./static/models/model.essence"),t=await e.text();a(t)}(0,c.useEffect)(()=>{i()},[]);let o=async e=>await fetch("https://conjure-aas.cs.st-andrews.ac.uk/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobid:e,appName:"nurse-rostering"})}).then(e=>e.json()).then(e=>e||null).catch(e=>(console.error(e),null)),u=async e=>(await i(),await fetch("https://conjure-aas.cs.st-andrews.ac.uk/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appName:"nurse-rostering",solver:"kissat",model:l,data:e,conjure_options:["--savilerow-options","-sat-sum-mdd","--channelling=no","-aai","--responses=2"]})}).then(e=>e.json()).then(e=>e&&e.jobid?e.jobid:null).catch(e=>(console.error(e),null))),d=async(e,t)=>{let n=new Set;e.forEach(e=>{e.skills.forEach(e=>{n.add(e)})});let r={};e.forEach((e,t)=>{r[e.id]=t+1});let l={};Array.from(n).forEach((e,t)=>{l[e]=t+1});let s={nb_nurses:e.length,nb_weeks:4,nb_skills:n.size,preferred_shift_type:{},maximum_working_days_in_a_row:{},nurse_skills:{},skills_lower_bound:{},disallowed:[]};e.forEach(e=>{let t=e.constraints.find(e=>"Preferred Shift Time"===e.label),n=(null==t?void 0:t.options[(null==t?void 0:t.selectedIndex)||0])||"Day";s.preferred_shift_type[r[e.id]]="Day"===n?1:2;let a=e.constraints.find(e=>"Maximum Working Days in a Row"===e.label);s.maximum_working_days_in_a_row[r[e.id]]=parseInt((null==a?void 0:a.options[(null==a?void 0:a.selectedIndex)||0])||"0",10),s.nurse_skills[r[e.id]]=e.skills.map(e=>l[e])}),Object.entries(t).forEach(e=>{s.skills_lower_bound[l[e[0]]]=e[1].minCount});let a=await u(JSON.stringify(s));return{jobid:a,staffEncoding:r,skillEncoding:l}},f=e=>new Promise(t=>setTimeout(t,e)),m=async t=>{e.current=t.jobid;let r=await o(t.jobid);if(!r)return null;let l=Date.now();for(;"wait"===r.status&&e.current==t.jobid;){if(Date.now()-l>=1e4)return["timeout",[]];await f(1e3),r=await o(t.jobid)}if(!r.solution)return["cancelled",[]];if(r.solution.length>0){let e=function(e,t){let n=s()(),r=1===n.weekday()&&n.isToday()?n:n.weekday(1),l=[7,0],a=[19,0],i=e.map(e=>{let n=e[0][0],s=e[0][1],i=e[1],o=r.add(s-1,"day"),u=1===i?l:a,c=o.hour(u[0]).minute(u[1]).second(0),d=c.clone().add(432e5,"millisecond");return{id:"".concat(n,"-").concat(s,"-").concat(i),resourceId:"".concat(function(e){let t={};for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let r=e[n];t[r]=n}return t}(t.staffEncoding)[n]),start:c.format(),end:d.format()}});return["ok",i]}(r.solution[0].assignment,t);return n(e[1]),e}return["no-solution",[]]};return{schedule:t,setSchedule:n,getSchedule:function(){return t},postSchedule:d,fetchSchedule:m}}s().extend(i()),s().extend(u())},1215:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(9797),l=n(1872);function s(){let[e,t]=(0,r.Z)("staffList",{defaultValue:[]}),[n,s]=(0,r.Z)("skillList",{defaultValue:{}}),a=(t,r)=>{let l=r.filter(e=>!n.hasOwnProperty(e));return l.forEach(e=>{n[e]={count:0,minCount:0}}),Object.entries(n).reduce((n,l)=>{var s,a;let[i,o]=l,u=null!==(a=null===(s=e.find(e=>e.id===t))||void 0===s?void 0:s.skills.filter(e=>e===i).length)&&void 0!==a?a:0,c=o.count-u,d=r.filter(e=>e===i).length;return{...n,...c+d>0?{[i]:{count:c+d,minCount:0}}:{}}},{})};return{staffList:e,skillList:n,addStaffMember:(r,a,i)=>{a=a.map(e=>e.toUpperCase());let o={id:(0,l.Z)(),name:r,skills:a,constraints:i};t([...e,o]),s({...n,...a.reduce((e,t)=>{var r;return{...e,[t]:{count:((null===(r=n[t])||void 0===r?void 0:r.count)||0)+1,minCount:0}}},{})})},removeStaffMember:n=>{let r=e.filter(e=>e.id!==n);t(r);let l=a(n,[]);s(l)},updateStaffMember:(n,r,l,i)=>{let o=e.map(e=>e.id===n?{id:n,name:r,skills:l,constraints:i}:e);t(o);let u=a(n,l);s(u)},countStaffMembers:()=>e.length,setSkillMinCount:(e,t)=>{n[e]?s({...n,[e]:{...n[e],minCount:t}}):console.warn('Skill "'.concat(e,'" not found in skillList.'))}}}}},function(e){e.O(0,[57,88,971,472,744],function(){return e(e.s=5458)}),_N_E=e.O()}]);