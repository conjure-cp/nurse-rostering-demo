(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[862],{387:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var r=n(5155),s=n(3092),i=n(6562),a=n(8815),l=n(2755);n(2115);var o=n(2734),d=n(2216);let c=e=>{let{staffId:t}=e,{staffList:n}=(0,o.A)(),c=n.find(e=>e.id===t);return(0,r.jsxs)(s.$,{children:[(0,r.jsxs)(i.r,{children:[c&&c.name," Personal Timetable"]}),(0,r.jsx)(a.s,{}),(0,r.jsx)(l.c,{children:(0,r.jsx)(d.A,{staffId:t})})]})}},807:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>N});var r=n(5155),s=n(2115),i=n(4266),a=n(3947),l=n(4396),o=n(2734),d=n(5504),c=n(5051),u=n(981),f=n(6391),h=n(5508),m=n(3092),p=n(3708),g=n(9343),x=n(5543),j=n(832),w=n.n(j),b=n(387);let v=()=>{let{staffList:e,skillList:t}=(0,o.A)(),{postSchedule:n,fetchSchedule:j,getSchedule:v,setSchedule:y}=(0,x.A)(),{isOpen:k=!1,onOpen:S,onClose:C}=(0,d.j)(),_=(0,c.d)(),A=(0,s.useRef)(null),[E,D]=s.useState(0),[N,I]=(0,s.useState)(null),{isOpen:O,onOpen:T,onClose:L}=(0,d.j)(),[W,P]=s.useState(""),H=e=>{let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);let n=(255&t)%128+127,r=(t>>8&255)%128+127,s=(t>>16&255)%128+127,i=n.toString(16).padStart(2,"0"),a=r.toString(16).padStart(2,"0"),l=s.toString(16).padStart(2,"0");return"#".concat(i).concat(a).concat(l)},M=(()=>{let t={};return e.forEach(e=>{t[e.id]=H(e.id)}),t})(),z=async()=>{let r=await n(e,t);S();let s=await j(r);s&&(C(),0===s[1].length?"cancelled"===s[0]?(_({title:"Rerunning schedule request",status:"info",duration:3e3,position:"top",isClosable:!0}),S()):"timeout"===s[0]?_({title:"Request timed out",description:"We couldn't find a schedule for your request in time. Please check your staff list and constraints and try again.",status:"warning",duration:9e3,position:"top",isClosable:!0}):"no-solution"===s[0]&&_({title:"No schedule found",description:"We couldn't find a schedule for the given constraints",status:"warning",duration:9e3,position:"top",isClosable:!0}):A.current.getApi().gotoDate(J()))},J=(0,s.useCallback)(()=>{let e=v().map(e=>e.start);if(e.length<=0)return w()().toDate();let t=e.reduce((e,t)=>w()(e).isBefore(w()(t))?e:t);return w()().isBefore(w()(t))?t:w()().toDate()},[v]),R=(0,s.useCallback)(e=>{P(e),T()},[T]);return(0,r.jsxs)("div",{suppressHydrationWarning:!0,children:[(0,r.jsx)("div",{className:"p-4 m-4 h-full bg-surface1 rounded-xl",children:(0,r.jsx)(i.A,{schedulerLicenseKey:"CC-Attribution-NonCommercial-NoDerivatives",plugins:[a.A,l.Ay],initialView:"resourceTimelineWeek",datesSet:()=>{D(E+1)},slotDuration:"12:00:00",slotMinTime:"07:00:00",eventDragStart:e=>{I(e.event._def.resourceIds[0])},eventAllow:e=>N===e.resource.id,contentHeight:"auto",ref:A,resourceAreaWidth:"15%",resourceAreaHeaderContent:"Staff",defaultTimedEventDuration:"12:00:00",eventDrop:e=>{let{event:t,oldEvent:n}=e;y(v().map(e=>e.id===t.id?{...e,start:t.start,end:t.end,resourceId:e.resourceId}:e))},firstDay:1,editable:!0,resourceLabelContent:e=>{let t=e.resource.id;return(0,r.jsx)("span",{onClick:()=>R(t),style:{minHeight:"40px"},children:e.resource.title})},initialDate:J(),nowIndicator:!0,resources:e.map(e=>({id:e.id,title:e.name})),eventInteractive:!0,eventDisplay:"block",events:v().map(e=>({id:e.id,resourceId:e.resourceId,start:e.start,end:e.end,backgroundColor:M[e.resourceId],editable:!0,borderColor:"purple",overlap:!1}))})}),(0,r.jsx)(u.$,{className:"bg-primary text-white absolute top-2 right-4 m-4","aria-label":"Add event",onClick:z,children:"SCHEDULE"}),(0,r.jsx)("style",{suppressHydrationWarning:!0,children:"\n        @media only screen and (max-width: 800px) {\n          .fc-toolbar-title {\n            font-size: 1em !important;\n          }\n        }\n        .fc .fc-datagrid-cell-cushion {\n          overflow-x: scroll;\n          -ms-overflow-style: none;  /* IE and Edge */\n          scrollbar-width: none;  /* Firefox */\n        } \n         /* Hide scrollbar for Chrome, Safari and Opera */\n        .fc .fc-datagrid-cell-cushion ::-webkit-scrollbar {\n          display: none;\n        }\n\n        .fc-theme-standard .fc-scrollgrid { \n          border: none;\n        }\n        .fc-timeline-lane-frame:hover {\n          background-color: #e9e9e9;\n          transition-duration: 300ms;\n        }\n        .fc-datagrid-cell-main:hover { \n          cursor: pointer;\n          color: purple;\n        }\n        td > .fc-datagrid-cell-frame {\n          height: 40px !important;\n        }\n        tr > td > .fc-timeline-lane-frame {\n          height: 40px !important;\n        }\n        \n      "}),(0,r.jsxs)(f.aF,{isOpen:k,onClose:C,isCentered:!0,children:[(0,r.jsx)(h.m,{}),(0,r.jsx)(m.$,{className:"w-20 h-20",children:(0,r.jsx)(p.o,{className:"h-full w-full flex justify-center",children:(0,r.jsx)(g.y,{size:"xl"})})})]}),(0,r.jsxs)(f.aF,{isOpen:O,onClose:L,children:[(0,r.jsx)(h.m,{}),(0,r.jsx)(b.A,{staffId:W})]})]})};var y=n(2216),k=n(520),S=n(7085),C=n(122),_=n(4541),A=n(7891),E=n(5796);let D=()=>{let{staffList:e}=(0,o.A)();return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(k.n,{allowMultiple:!0,children:e.map(e=>(0,r.jsxs)(S.A,{className:"border-surface3",children:[(0,r.jsx)("h2",{children:(0,r.jsxs)(C.J,{children:[(0,r.jsx)(_.az,{as:"span",flex:"1",textAlign:"left",children:(0,r.jsx)("h2",{className:"text-center",children:e.name})}),(0,r.jsx)(A.Q,{})]})}),(0,r.jsx)(E.v,{pb:4,className:"bg-surface3 rounded-xl hover-shadow",children:(0,r.jsx)(y.A,{staffId:e.id})})]},e.id))})})},N=()=>{let[e,t]=(0,s.useState)(!0),n=()=>{t(window.innerWidth>650)};return(0,s.useEffect)(()=>(n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)),[]),(0,r.jsx)("main",{children:e?(0,r.jsx)(v,{}):(0,r.jsx)(D,{})})}},2216:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var r=n(5155),s=n(9168),i=n(7641);n(2115);var a=n(2734),l=n(5543),o=n(2515);let d=e=>{let{staffId:t}=e,{staffList:n}=(0,a.A)(),{schedule:d}=(0,l.A)();n.find(e=>e.id===t);let c=d.filter(e=>e.resourceId===t),u=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=new Date(e),r={month:"long",day:"numeric"};return t&&(r.weekday="long"),n.toLocaleString("en-US",r)},f=e=>e.getHours()>=19?(0,r.jsxs)("div",{className:"flex gap-2 leading-none",children:[(0,r.jsx)(o.ILJ,{}),(0,r.jsx)(s.E,{children:"Night Shift"})]}):(0,r.jsxs)("div",{className:"flex gap-2 leading-none",children:[(0,r.jsx)(o.pvz,{}),(0,r.jsx)(s.E,{children:"Day Shift"})]}),h=(e=>{let t=e.sort((e,t)=>new Date(e.start).getTime()-new Date(t.start).getTime()),n={};return t.forEach(e=>{let t=new Date(e.start);t.setDate(t.getDate()-(t.getDay()+6)%7);let r=t.toISOString().slice(0,10);n[r]||(n[r]=[]),n[r].push(e)}),n})(c);return(0,r.jsx)("div",{children:Object.entries(h).map(e=>{let[t,n]=e;return(0,r.jsxs)(i.T,{spacing:1,align:"start",className:"my-4",children:[(0,r.jsxs)(s.E,{fontWeight:"bold",children:["Week of ",u(t,!1)]}),n.map(e=>(0,r.jsxs)("div",{className:"w-full flex justify-between",children:[(0,r.jsx)(s.E,{children:u(e.start)}),f(new Date(e.start))]},e.id))]},t)})})}},2570:(e,t,n)=>{Promise.resolve().then(n.bind(n,807))},2734:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(9208),s=n(9737);function i(){let[e,t]=(0,r.A)("staffList",{defaultValue:[]}),[n,i]=(0,r.A)("skillList",{defaultValue:{}}),a=(t,r)=>(r.filter(e=>!n.hasOwnProperty(e)).forEach(e=>{n[e]={count:0,minCount:0}}),Object.entries(n).reduce((n,s)=>{var i,a;let[l,o]=s,d=null!==(a=null===(i=e.find(e=>e.id===t))||void 0===i?void 0:i.skills.filter(e=>e===l).length)&&void 0!==a?a:0,c=o.count-d,u=r.filter(e=>e===l).length;return{...n,...c+u>0?{[l]:{count:c+u,minCount:0}}:{}}},{}));return{staffList:e,skillList:n,addStaffMember:(r,a,l)=>{a=a.map(e=>e.toUpperCase()),t([...e,{id:(0,s.A)(),name:r,skills:a,constraints:l}]),i({...n,...a.reduce((e,t)=>{var r;return{...e,[t]:{count:((null===(r=n[t])||void 0===r?void 0:r.count)||0)+1,minCount:0}}},{})})},removeStaffMember:n=>{t(e.filter(e=>e.id!==n)),i(a(n,[]))},updateStaffMember:(n,r,s,l)=>{t(e.map(e=>e.id===n?{id:n,name:r,skills:s,constraints:l}:e)),i(a(n,s))},countStaffMembers:()=>e.length,setSkillMinCount:(e,t)=>{n[e]?i({...n,[e]:{...n[e],minCount:t}}):console.warn('Skill "'.concat(e,'" not found in skillList.'))}}}},5543:(e,t,n)=>{"use strict";n.d(t,{A:()=>u});var r=n(9208),s=n(832),i=n.n(s),a=n(6004),l=n.n(a),o=n(9643),d=n.n(o),c=n(2115);function u(){let e=(0,c.useRef)(-1),[t,n]=(0,r.A)("schedule",{defaultValue:[]}),[s,a]=(0,c.useState)("");async function l(){let e=await fetch("./static/models/model.essence");a(await e.text())}(0,c.useEffect)(()=>{l()},[]);let o=async e=>await fetch("https://conjure-aas.cs.st-andrews.ac.uk/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobid:e,appName:"nurse-rostering"})}).then(e=>e.json()).then(e=>e||null).catch(e=>(console.error(e),null)),d=async e=>(await l(),await fetch("https://conjure-aas.cs.st-andrews.ac.uk/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appName:"nurse-rostering",solver:"kissat",model:s,data:e,conjure_options:["--savilerow-options","-sat-sum-mdd","--channelling=no","-aai","--responses=2"]})}).then(e=>e.json()).then(e=>e&&e.jobid?e.jobid:null).catch(e=>(console.error(e),null))),u=e=>new Promise(t=>setTimeout(t,e)),f=async t=>{e.current=t.jobid;let r=await o(t.jobid);if(!r)return null;let s=Date.now();for(;"wait"===r.status&&e.current==t.jobid;){if(Date.now()-s>=1e4)return["timeout",[]];await u(1e3),r=await o(t.jobid)}if(!r.solution)return["cancelled",[]];if(r.solution.length>0){let e=function(e,t){let n=i()(),r=1===n.weekday()&&n.isToday()?n:n.weekday(1),s=[7,0],a=[19,0];return["ok",e.map(e=>{let n=e[0][0],i=e[0][1],l=e[1],o=r.add(i-1,"day"),d=1===l?s:a,c=o.hour(d[0]).minute(d[1]).second(0),u=c.clone().add(432e5,"millisecond");return{id:"".concat(n,"-").concat(i,"-").concat(l),resourceId:"".concat(function(e){let t={};for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[e[n]]=n);return t}(t.staffEncoding)[n]),start:c.format(),end:u.format()}})]}(r.solution[0].assignment,t);return n(e[1]),e}return["no-solution",[]]};return{schedule:t,setSchedule:n,getSchedule:function(){return t},postSchedule:async(e,t)=>{let n=new Set;e.forEach(e=>{e.skills.forEach(e=>{n.add(e)})});let r={};e.forEach((e,t)=>{r[e.id]=t+1});let s={};Array.from(n).forEach((e,t)=>{s[e]=t+1});let i={nb_nurses:e.length,nb_weeks:4,nb_skills:n.size,preferred_shift_type:{},maximum_working_days_in_a_row:{},nurse_skills:{},skills_lower_bound:{},disallowed:[]};return e.forEach(e=>{let t=e.constraints.find(e=>"Preferred Shift Time"===e.label),n=(null==t?void 0:t.options[(null==t?void 0:t.selectedIndex)||0])||"Day";i.preferred_shift_type[r[e.id]]="Day"===n?1:2;let a=e.constraints.find(e=>"Maximum Working Days in a Row"===e.label);i.maximum_working_days_in_a_row[r[e.id]]=parseInt((null==a?void 0:a.options[(null==a?void 0:a.selectedIndex)||0])||"0",10),i.nurse_skills[r[e.id]]=e.skills.map(e=>s[e])}),Object.entries(t).forEach(e=>{i.skills_lower_bound[s[e[0]]]=e[1].minCount}),{jobid:await d(JSON.stringify(i)),staffEncoding:r,skillEncoding:s}},fetchSchedule:f}}i().extend(l()),i().extend(d())}},e=>{var t=t=>e(e.s=t);e.O(0,[479,18,628,343,928,761,469,505,441,684,358],()=>t(2570)),_N_E=e.O()}]);