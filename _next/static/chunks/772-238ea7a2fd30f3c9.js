"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[772],{876:function(e,t,l){l.d(t,{Cb:function(){return v},HU:function(){return getOptionArray}});var n=l(7437),s=l(954),a=l(6526),i=l(5405),r=l(3391),o=l(1629),d=l(4159),c=l(1091),h=l(6095),f=l(1107),u=l(3470),x=l(8003),j=l(4221),m=l(3621),p=l(6973),g=l(947),S=l(6621),y=l(6641),k=l(8610),b=l(1504),C=l(2265),w=l(1215);let v=[{label:"Preferred Shift Time",defaultIndex:0,selectedIndex:0,options:["Day","Night"]},{label:"Maximum Working Days in a Row",defaultIndex:3,selectedIndex:3,options:[...Array.from({length:4},(e,t)=>(t+0).toString())]}],getOptionArray=e=>{let t=[];return t.push((0,n.jsx)("option",{value:e.options[e.selectedIndex],disabled:!0,hidden:!0,children:e.options[e.selectedIndex]},"default")),e.options.forEach((e,l)=>{t.push((0,n.jsx)("option",{value:l,children:e},l))}),t};t.ZP=e=>{let{isModalOpen:t,onModalOpen:l,onModalClose:_}=e,{skillList:N,addStaffMember:E}=(0,w.Z)(),[M,I]=C.useState(""),[D,O]=C.useState(""),[T,Z]=(0,C.useState)(""),[U,P]=(0,C.useState)(["STAFF"]),z=C.useRef(null),handleSkillBadgeClick=e=>{"STAFF"!==e&&P(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},handleCreateStaff=()=>{""!==M.trim()&&(E(M.trim(),U,v),I(""),O(""),P(["STAFF"]),_())};return(0,n.jsxs)(s.u_,{isOpen:t,onClose:_,children:[(0,n.jsx)(a.Z,{}),(0,n.jsxs)(i.h,{children:[(0,n.jsx)(r.x,{children:"Create staff member"}),(0,n.jsx)(o.o,{}),(0,n.jsx)(d.f,{children:(0,n.jsxs)("form",{className:"flex flex-col gap-4",onKeyPress:e=>{"Enter"===e.key&&handleCreateStaff()},children:[(0,n.jsx)(c.I,{onChange:e=>I(e.target.value),placeholder:"Name",value:M}),(0,n.jsx)(c.I,{onChange:e=>Z(e.target.value),onKeyDown:e=>{if("Enter"===e.key&&""!==T.trim()){e.preventDefault();let t=T.trim().toUpperCase();U.includes(t)||P(e=>[...e,t]),Z("")}},placeholder:"New Qualification",value:T}),(0,n.jsxs)(h.E,{children:[Object.keys(N).map((e,t)=>(0,n.jsx)(h.U,{children:(0,n.jsx)(f.C,{size:"l",onClick:()=>handleSkillBadgeClick(e),colorScheme:U.includes(e)?"purple":"gray",cursor:"pointer",children:e},t)},t)),U.filter(e=>!N.hasOwnProperty(e)).map((e,t)=>(0,n.jsx)(h.U,{children:(0,n.jsx)(f.C,{size:"l",onClick:()=>handleSkillBadgeClick(e),colorScheme:U.includes(e)?"purple":"gray",cursor:"pointer",children:e},"new-".concat(t))},t))]}),(0,n.jsx)(u.U,{allowToggle:!0,children:(0,n.jsxs)(x.Q,{children:[(0,n.jsx)("h2",{children:(0,n.jsxs)(j.K,{children:[(0,n.jsx)(m.xu,{flex:"1",textAlign:"left",children:"Constraints"}),(0,n.jsx)(p.X,{})]})}),(0,n.jsx)(g.H,{pb:4,children:v.map((e,t)=>(0,n.jsxs)("div",{className:"flex my-4 gap-4",children:[(0,n.jsx)(S.k,{className:"text-sm basis-[150%] items-center justify-end",children:(0,n.jsx)("label",{className:"align-right text-right",children:e.label})}),(0,n.jsx)(y.P,{className:"my-1",defaultValue:e.defaultIndex,onChange:t=>{e.selectedIndex=parseInt(t.target.value)},children:getOptionArray(e)},t)]},t))})]})})]})}),(0,n.jsxs)(k.m,{children:[(0,n.jsx)(b.z,{onClick:_,variant:"ghost",children:"Cancel"}),(0,n.jsx)(b.z,{className:"bg-primary text-white hover:shadow-lg hover:bg-opacity-80",mr:3,onClick:handleCreateStaff,disabled:""===M.trim(),ref:z,children:"Create"})]})]})]})}},7772:function(e,t,l){l.d(t,{Z:function(){return StaffModal_StaffModal}});var n=l(7437),s=l(954),a=l(6526),i=l(2265),r=l(5405),o=l(3391),d=l(1629),c=l(4159),h=l(1091),f=l(6095),u=l(1107),x=l(3470),j=l(8003),m=l(4221),p=l(3621),g=l(6973),S=l(947),y=l(6621),k=l(6641),b=l(8610),C=l(1504),w=l(876),v=l(1215),StaffModal_EditStaffModal=e=>{let{onModalClose:t,staffId:l}=e,{staffList:s,skillList:a,updateStaffMember:_}=(0,v.Z)(),N=s.find(e=>e.id===l),[E,M]=(0,i.useState)(N&&N.name),[I,D]=(0,i.useState)(""),[O,T]=(0,i.useState)(N?N.skills:[]),handleSkillBadgeClick=e=>{"STAFF"!==e&&T(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},handleEditStaff=()=>{E&&""!==E.trim()&&(_(l,E.trim(),O,w.Cb),t())};return(0,n.jsxs)(r.h,{children:[(0,n.jsx)(o.x,{children:"Edit staff member"}),(0,n.jsx)(d.o,{}),(0,n.jsx)(c.f,{children:(0,n.jsxs)("form",{className:"flex flex-col gap-4",onKeyPress:e=>{"Enter"===e.key&&handleEditStaff()},children:[(0,n.jsx)(h.I,{placeholder:"Name",value:E,onChange:e=>M(e.target.value)}),(0,n.jsx)(h.I,{onChange:e=>D(e.target.value),onKeyDown:e=>{if("Enter"===e.key&&""!==I.trim()){e.preventDefault();let t=I.trim().toUpperCase();T(e=>[...e,t]),D("")}},placeholder:"New Qualification",value:I}),(0,n.jsxs)(f.E,{children:[Object.keys(a).map((e,t)=>(0,n.jsx)(f.U,{children:(0,n.jsx)(u.C,{size:"xl",onClick:()=>handleSkillBadgeClick(e),colorScheme:O.includes(e)?"purple":"gray",cursor:"pointer",children:e},t)},t)),O.filter(e=>!a.hasOwnProperty(e)).map((e,t)=>(0,n.jsx)(f.U,{children:(0,n.jsx)(u.C,{size:"xl",onClick:()=>handleSkillBadgeClick(e),colorScheme:O.includes(e)?"purple":"gray",cursor:"pointer",children:e},"new-".concat(t))},t))]}),(0,n.jsx)(x.U,{allowToggle:!0,children:(0,n.jsxs)(j.Q,{children:[(0,n.jsx)("h2",{children:(0,n.jsxs)(m.K,{children:[(0,n.jsx)(p.xu,{flex:"1",textAlign:"left",children:"Constraints"}),(0,n.jsx)(g.X,{})]})}),(0,n.jsx)(S.H,{pb:4,children:w.Cb.map((e,t)=>(0,n.jsxs)("div",{className:"flex my-4 gap-4",children:[(0,n.jsx)(y.k,{className:"text-sm basis_[150%] items-center justify-end",children:(0,n.jsx)("label",{className:"align-right text-right",children:e.label})}),(0,n.jsx)(k.P,{className:"my-1",defaultValue:e.selectedIndex,onChange:t=>{e.selectedIndex=parseInt(t.target.value)},children:(0,w.HU)(e)},t)]},t))})]})})]})}),(0,n.jsxs)(b.m,{children:[(0,n.jsx)(C.z,{onClick:t,variant:"ghost",children:"Cancel"}),(0,n.jsx)(C.z,{className:"bg-primary text-white hover:shadow-lg hover:bg-opacity-80",mr:3,onClick:handleEditStaff,disabled:!E||""===E.trim(),children:"Save"})]})]})},_=l(8910),N=l(2879),hooks_useModal=()=>{let[e,t]=(0,i.useState)(!1),closeModal=()=>t(!1);return{ModalComponent:()=>(0,n.jsx)(N.h,{children:(0,n.jsxs)(s.u_,{isOpen:e,onClose:closeModal,children:[(0,n.jsx)(a.Z,{}),(0,n.jsxs)(r.h,{children:[(0,n.jsx)(o.x,{children:"Chakra UI Modal"}),(0,n.jsx)(d.o,{}),(0,n.jsx)(c.f,{children:"Here is some content for the modal."}),(0,n.jsx)(b.m,{children:(0,n.jsx)(C.z,{colorScheme:"blue",onClick:closeModal,children:"Close"})})]})]})}),openModal:()=>t(!0),closeModal}},StaffModal_DisplayStaffModal=e=>{let{onModalClose:t,setType:l,staffId:s}=e,{staffList:a,removeStaffMember:i}=(0,v.Z)(),h=a.find(e=>e.id===s),{ModalComponent:y,openModal:k}=hooks_useModal();return(0,n.jsxs)(r.h,{children:[(0,n.jsx)(o.x,{children:h&&h.name}),(0,n.jsx)(d.o,{}),(0,n.jsx)(c.f,{children:(0,n.jsxs)("form",{className:"flex flex-col gap-4",children:[(0,n.jsxs)(p.xu,{className:"flex justify-between gap-4",children:[(0,n.jsx)("strong",{children:"Qualifications:"}),(0,n.jsx)(f.E,{children:h&&h.skills.map((e,t)=>(0,n.jsx)(f.U,{children:(0,n.jsx)(u.C,{size:"lg",children:e})},t))})]}),(0,n.jsx)(x.U,{allowToggle:!0,children:(0,n.jsxs)(j.Q,{children:[(0,n.jsx)("h2",{children:(0,n.jsxs)(m.K,{children:[(0,n.jsx)(p.xu,{flex:"1",textAlign:"left",children:"Constraints"}),(0,n.jsx)(g.X,{})]})}),(0,n.jsx)(S.H,{pb:4,children:h&&h.constraints.map((e,t)=>(0,n.jsxs)("div",{className:"flex my-4 gap-4 justify-between",children:[(0,n.jsx)("label",{className:"align-right w-fit",children:e.label}),(0,n.jsx)("p",{className:"font-bold",children:e.options[e.selectedIndex]})]},t))})]})})]})}),(0,n.jsxs)(b.m,{className:"flex justify-between",children:[(0,n.jsx)(C.z,{variant:"ghost",color:"red",onClick:()=>{t(),i(s)},children:"Delete"}),(0,n.jsx)(C.z,{leftIcon:(0,n.jsx)(_.CLb,{}),variant:"ghost",onClick:()=>{l("timetable")},children:"Timetable"}),(0,n.jsx)(C.z,{variant:"outline",onClick:()=>{l("edit")},children:"Edit"})]}),(0,n.jsx)(y,{})]})},E=l(8145),StaffModal_StaffModal=e=>{let{staffId:t,isModalOpen:l,onModalOpen:r,onModalClose:o}=e,[d,c]=(0,i.useState)("display");return(0,i.useEffect)(()=>{c("display")},[l]),(0,n.jsxs)(s.u_,{isOpen:l,onClose:o,children:[(0,n.jsx)(a.Z,{}),"edit"===d?(0,n.jsx)(StaffModal_EditStaffModal,{onModalClose:o,staffId:t}):"timetable"===d?(0,n.jsx)(E.Z,{staffId:t}):(0,n.jsx)(StaffModal_DisplayStaffModal,{onModalClose:o,setType:c,staffId:t})]})}},8145:function(e,t,l){var n=l(7437),s=l(5405),a=l(3391),i=l(1629),r=l(4159);l(2265);var o=l(1215),d=l(421);t.Z=e=>{let{staffId:t}=e,{staffList:l}=(0,o.Z)(),c=l.find(e=>e.id===t);return(0,n.jsxs)(s.h,{children:[(0,n.jsxs)(a.x,{children:[c&&c.name," Personal Timetable"]}),(0,n.jsx)(i.o,{}),(0,n.jsx)(r.f,{children:(0,n.jsx)(d.Z,{staffId:t})})]})}},421:function(e,t,l){var n=l(7437),s=l(9126),a=l(7766);l(2265);var i=l(1215),r=l(8683),o=l(8910);t.Z=e=>{let{staffId:t}=e,{staffList:l}=(0,i.Z)(),{schedule:d}=(0,r.Z)();l.find(e=>e.id===t);let c=d.filter(e=>e.resourceId===t),formatDate=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],l=new Date(e),n={month:"long",day:"numeric"};return t&&(n.weekday="long"),l.toLocaleString("en-US",n)},formatShiftType=e=>e.getHours()>=19?(0,n.jsxs)("div",{className:"flex gap-2 leading-none",children:[(0,n.jsx)(o.v70,{}),(0,n.jsx)(s.x,{children:"Night Shift"})]}):(0,n.jsxs)("div",{className:"flex gap-2 leading-none",children:[(0,n.jsx)(o.Wn6,{}),(0,n.jsx)(s.x,{children:"Day Shift"})]}),h=(e=>{let t=e.sort((e,t)=>new Date(e.start).getTime()-new Date(t.start).getTime()),l={};return t.forEach(e=>{let t=new Date(e.start);t.setDate(t.getDate()-(t.getDay()+6)%7);let n=t.toISOString().slice(0,10);l[n]||(l[n]=[]),l[n].push(e)}),l})(c);return(0,n.jsx)("div",{children:Object.entries(h).map(e=>{let[t,l]=e;return(0,n.jsxs)(a.g,{spacing:1,align:"start",className:"my-4",children:[(0,n.jsxs)(s.x,{fontWeight:"bold",children:["Week of ",formatDate(t,!1)]}),l.map(e=>(0,n.jsxs)("div",{className:"w-full flex justify-between",children:[(0,n.jsx)(s.x,{children:formatDate(e.start)}),formatShiftType(new Date(e.start))]},e.id))]},t)})})}},8683:function(e,t,l){l.d(t,{Z:function(){return useSchedule}});var n=l(4401),s=l(4548),a=l.n(s),i=l(8355),r=l.n(i),o=l(4487),d=l.n(o),c=l(2265);function useSchedule(){let e=(0,c.useRef)(-1),[t,l]=(0,n.Z)("schedule",{defaultValue:[]}),[s,i]=(0,c.useState)("");async function fetchFile(){let e=await fetch("./static/models/model.essence"),t=await e.text();i(t)}(0,c.useEffect)(()=>{fetchFile()},[]);let server_getSchedule=async e=>await fetch("https://conjure-aas.cs.st-andrews.ac.uk/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobid:e,appName:"nurse-rostering"})}).then(e=>e.json()).then(e=>e||null).catch(e=>(console.error(e),null)),server_postSchedule=async e=>(await fetchFile(),await fetch("https://conjure-aas.cs.st-andrews.ac.uk/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appName:"nurse-rostering",solver:"kissat",model:s,data:e,conjure_options:["--savilerow-options","-sat-sum-mdd","--channelling=no","-aai","--responses=2"]})}).then(e=>e.json()).then(e=>e&&e.jobid?e.jobid:null).catch(e=>(console.error(e),null))),postSchedule=async(e,t)=>{let l=new Set;e.forEach(e=>{e.skills.forEach(e=>{l.add(e)})});let n={};e.forEach((e,t)=>{n[e.id]=t+1});let s={};Array.from(l).forEach((e,t)=>{s[e]=t+1});let a={nb_nurses:e.length,nb_weeks:4,nb_skills:l.size,preferred_shift_type:{},maximum_working_days_in_a_row:{},nurse_skills:{},skills_lower_bound:{},disallowed:[]};e.forEach(e=>{let t=e.constraints.find(e=>"Preferred Shift Time"===e.label),l=(null==t?void 0:t.options[(null==t?void 0:t.selectedIndex)||0])||"Day";a.preferred_shift_type[n[e.id]]="Day"===l?1:2;let i=e.constraints.find(e=>"Maximum Working Days in a Row"===e.label);a.maximum_working_days_in_a_row[n[e.id]]=parseInt((null==i?void 0:i.options[(null==i?void 0:i.selectedIndex)||0])||"0",10),a.nurse_skills[n[e.id]]=e.skills.map(e=>s[e])}),Object.entries(t).forEach(e=>{a.skills_lower_bound[s[e[0]]]=e[1].minCount});let i=await server_postSchedule(JSON.stringify(a));return{jobid:i,staffEncoding:n,skillEncoding:s}},delay=e=>new Promise(t=>setTimeout(t,e)),fetchSchedule=async t=>{e.current=t.jobid;let n=await server_getSchedule(t.jobid);if(!n)return null;let s=Date.now();for(;"wait"===n.status&&e.current==t.jobid;){if(Date.now()-s>=1e4)return["timeout",[]];await delay(1e3),n=await server_getSchedule(t.jobid)}if(!n.solution)return["cancelled",[]];if(n.solution.length>0){let e=function(e,t){let l=a()(),n=1===l.weekday()&&l.isToday()?l:l.weekday(1),s=[7,0],i=[19,0],r=e.map(e=>{let l=e[0][0],a=e[0][1],r=e[1],o=n.add(a-1,"day"),d=1===r?s:i,c=o.hour(d[0]).minute(d[1]).second(0),h=c.clone().add(432e5,"millisecond");return{id:"".concat(l,"-").concat(a,"-").concat(r),resourceId:"".concat(function(e){let t={};for(let l in e)if(Object.prototype.hasOwnProperty.call(e,l)){let n=e[l];t[n]=l}return t}(t.staffEncoding)[l]),start:c.format(),end:h.format()}});return["ok",r]}(n.solution[0].assignment,t);return l(e[1]),e}return["no-solution",[]]};return{schedule:t,setSchedule:l,getSchedule:function(){return t},postSchedule,fetchSchedule}}a().extend(r()),a().extend(d())},1215:function(e,t,l){l.d(t,{Z:function(){return useStaffList}});var n=l(4401),s=l(1872);function useStaffList(){let[e,t]=(0,n.Z)("staffList",{defaultValue:[]}),[l,a]=(0,n.Z)("skillList",{defaultValue:{}}),getUpdatedSkillList=(t,n)=>{let s=n.filter(e=>!l.hasOwnProperty(e));return s.forEach(e=>{l[e]={count:0,minCount:0}}),Object.entries(l).reduce((l,s)=>{var a,i;let[r,o]=s,d=null!==(i=null===(a=e.find(e=>e.id===t))||void 0===a?void 0:a.skills.filter(e=>e===r).length)&&void 0!==i?i:0,c=o.count-d,h=n.filter(e=>e===r).length;return{...l,...c+h>0?{[r]:{count:c+h,minCount:0}}:{}}},{})};return{staffList:e,skillList:l,addStaffMember:(n,i,r)=>{i=i.map(e=>e.toUpperCase());let o={id:(0,s.Z)(),name:n,skills:i,constraints:r};t([...e,o]),a({...l,...i.reduce((e,t)=>{var n;return{...e,[t]:{count:((null===(n=l[t])||void 0===n?void 0:n.count)||0)+1,minCount:0}}},{})})},removeStaffMember:l=>{let n=e.filter(e=>e.id!==l);t(n);let s=getUpdatedSkillList(l,[]);a(s)},updateStaffMember:(l,n,s,i)=>{let r=e.map(e=>e.id===l?{id:l,name:n,skills:s,constraints:i}:e);t(r);let o=getUpdatedSkillList(l,s);a(o)},countStaffMembers:()=>e.length,setSkillMinCount:(e,t)=>{l[e]?a({...l,[e]:{...l[e],minCount:t}}):console.warn('Skill "'.concat(e,'" not found in skillList.'))}}}}}]);